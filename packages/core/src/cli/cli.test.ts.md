# Snapshot report for `src/cli/cli.test.ts`

The actual snapshot is saved in `cli.test.ts.snap`.

Generated by [AVA](https://avajs.dev).

## help

> Snapshot 1

    `Usage: npx @openzeppelin/upgrades-core validate [<BUILD_INFO_DIR>] [<OPTIONS>]␊
    ␊
    Detects upgradeable contracts from a build info directory and validates whether they are upgrade safe.␊
    ␊
    Arguments:␊
      <BUILD_INFO_DIR>  Optional path to the build info directory which contains JSON files with Solidity compiler input and output. Defaults to 'artifacts/build-info' for Hardhat projects or 'out/build-info' for Foundry projects. If your project uses a custom output directory, you must specify its build info directory here.␊
    ␊
    Options:␊
      --contract <CONTRACT>  The name or fully qualified name of the contract to validate. If not specified, all upgradeable contracts in the build info directory will be validated.␊
      --reference <REFERENCE_CONTRACT>  Can only be used when the --contract option is also provided. The name or fully qualified name of the reference contract to use for storage layout comparisons. If not specified, uses the @custom:oz-upgrades-from annotation if it is defined in the contract that is being validated.␊
      --requireReference  Can only be used when the --contract option is also provided. Not compatible with --unsafeSkipStorageCheck. If specified, requires either the --reference option to be provided or the contract to have a @custom:oz-upgrades-from annotation.␊
      --unsafeAllow "<VALIDATION_ERRORS>"  Selectively disable one or more validation errors. Comma-separated list with one or more of the following: state-variable-assignment, state-variable-immutable, external-library-linking, struct-definition, enum-definition, constructor, delegatecall, selfdestruct, missing-public-upgradeto␊
      --unsafeAllowRenames  Configure storage layout check to allow variable renaming.␊
      --unsafeSkipStorageCheck  Skips checking for storage layout compatibility errors. This is a dangerous option meant to be used as a last resort.␊
    `

## no args

> Snapshot 1

    `Usage: npx @openzeppelin/upgrades-core validate [<BUILD_INFO_DIR>] [<OPTIONS>]␊
    ␊
    Detects upgradeable contracts from a build info directory and validates whether they are upgrade safe.␊
    ␊
    Arguments:␊
      <BUILD_INFO_DIR>  Optional path to the build info directory which contains JSON files with Solidity compiler input and output. Defaults to 'artifacts/build-info' for Hardhat projects or 'out/build-info' for Foundry projects. If your project uses a custom output directory, you must specify its build info directory here.␊
    ␊
    Options:␊
      --contract <CONTRACT>  The name or fully qualified name of the contract to validate. If not specified, all upgradeable contracts in the build info directory will be validated.␊
      --reference <REFERENCE_CONTRACT>  Can only be used when the --contract option is also provided. The name or fully qualified name of the reference contract to use for storage layout comparisons. If not specified, uses the @custom:oz-upgrades-from annotation if it is defined in the contract that is being validated.␊
      --requireReference  Can only be used when the --contract option is also provided. Not compatible with --unsafeSkipStorageCheck. If specified, requires either the --reference option to be provided or the contract to have a @custom:oz-upgrades-from annotation.␊
      --unsafeAllow "<VALIDATION_ERRORS>"  Selectively disable one or more validation errors. Comma-separated list with one or more of the following: state-variable-assignment, state-variable-immutable, external-library-linking, struct-definition, enum-definition, constructor, delegatecall, selfdestruct, missing-public-upgradeto␊
      --unsafeAllowRenames  Configure storage layout check to allow variable renaming.␊
      --unsafeSkipStorageCheck  Skips checking for storage layout compatibility errors. This is a dangerous option meant to be used as a last resort.␊
    `

## validate - errors

> Snapshot 1

    `Stdout:  ✔  contracts/test/cli/Validate.sol:Safe␊
    ␊
     ✔  contracts/test/cli/Validate.sol:HasInitializer␊
    ␊
     ✔  contracts/test/cli/Validate.sol:HasUpgradeTo␊
    ␊
     ✘  contracts/test/cli/Validate.sol:HasUpgradeToConstructorUnsafe␊
    ␊
          contracts/test/cli/Validate.sol:33: Contract \`HasUpgradeToConstructorUnsafe\` has a constructor␊
              Define an initializer instead␊
              https://zpl.in/upgrades/error-001␊
    ␊
     ✘  contracts/test/cli/Validate.sol:MultipleUnsafe␊
    ␊
          contracts/test/cli/Validate.sol:53: Use of delegatecall is not allowed␊
              https://zpl.in/upgrades/error-002␊
          ␊
          contracts/test/cli/Validate.sol:58: Use of delegatecall is not allowed␊
              https://zpl.in/upgrades/error-002␊
          ␊
          contracts/test/cli/Validate.sol:44: Use of selfdestruct is not allowed␊
              https://zpl.in/upgrades/error-003␊
    ␊
     ✘  contracts/test/cli/Validate.sol:InheritsMultipleUnsafe␊
    ␊
          contracts/test/cli/Validate.sol:53: Use of delegatecall is not allowed␊
              https://zpl.in/upgrades/error-002␊
          ␊
          contracts/test/cli/Validate.sol:58: Use of delegatecall is not allowed␊
              https://zpl.in/upgrades/error-002␊
          ␊
          contracts/test/cli/Validate.sol:44: Use of selfdestruct is not allowed␊
              https://zpl.in/upgrades/error-003␊
    ␊
     ✘  contracts/test/cli/Validate.sol:UpgradesFromUUPS (upgrades from contracts/test/cli/Validate.sol:HasUpgradeTo)␊
    ␊
          contracts/test/cli/Validate.sol:72: Implementation is missing a public \`upgradeTo(address)\` or \`upgradeToAndCall(address,bytes)\` function␊
              Inherit UUPSUpgradeable to include one or both of these functions in your contract␊
              @openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol␊
              https://zpl.in/upgrades/error-008␊
    ␊
     ✔  contracts/test/cli/Validate.sol:UpgradesFromTransparent (upgrades from contracts/test/cli/Validate.sol:HasInitializer)␊
    ␊
     ✘  contracts/test/cli/Validate.sol:UnsafeAndStorageLayoutErrors (upgrades from contracts/test/cli/Validate.sol:StorageV1)␊
    ␊
          contracts/test/cli/Validate.sol:97: Use of selfdestruct is not allowed␊
              https://zpl.in/upgrades/error-003␊
    ␊
          contracts/test/cli/Validate.sol:94: Layout changed for \`__gap\` (uint256[49] -> uint256[49])␊
            - Slot changed from 1 to 2␊
            > Set __gap array to size 48␊
    ␊
     ✔  contracts/test/cli/Validate.sol:BecomesSafe (upgrades from contracts/test/cli/Validate.sol:MultipleUnsafe)␊
    ␊
     ✘  contracts/test/cli/Validate.sol:BecomesBadLayout (upgrades from contracts/test/cli/Validate.sol:BecomesSafe)␊
    ␊
          BecomesSafe: Deleted \`x\`␊
            > Keep the variable even if unused␊
    ␊
     ✘  contracts/test/cli/Validate.sol:StillUnsafe (upgrades from contracts/test/cli/Validate.sol:NonUpgradeable)␊
    ␊
          contracts/test/cli/Validate.sol:119: Use of selfdestruct is not allowed␊
              https://zpl.in/upgrades/error-003␊
    ␊
     ✔  contracts/test/cli/Validate.sol:InheritsAbstractUpgradeable␊
    ␊
     ✘  contracts/test/cli/Validate.sol:BothAnnotationsUnsafe (upgrades from contracts/test/cli/Validate.sol:StorageV1)␊
    ␊
          contracts/test/cli/Validate.sol:140: Use of selfdestruct is not allowed␊
              https://zpl.in/upgrades/error-003␊
    ␊
          contracts/test/cli/Validate.sol:137: Layout changed for \`__gap\` (uint256[49] -> uint256[49])␊
            - Slot changed from 1 to 2␊
            > Set __gap array to size 48␊
    ␊
    FAILED (14 upgradeable contracts detected, 6 passed, 8 failed)␊
    ␊
    Stderr: `

## validate - single contract

> Snapshot 1

    `Stdout:  ✘  contracts/test/cli/Validate.sol:NonUpgradeable␊
    ␊
          contracts/test/cli/Validate.sol:14: Use of selfdestruct is not allowed␊
              https://zpl.in/upgrades/error-003␊
    ␊
    FAILED␊
    ␊
    Stderr: `

## validate - single contract, has upgrades-from

> Snapshot 1

    `Stdout:  ✘  contracts/test/cli/Validate.sol:UnsafeAndStorageLayoutErrors (upgrades from contracts/test/cli/Validate.sol:StorageV1)␊
    ␊
          contracts/test/cli/Validate.sol:97: Use of selfdestruct is not allowed␊
              https://zpl.in/upgrades/error-003␊
    ␊
          contracts/test/cli/Validate.sol:94: Layout changed for \`__gap\` (uint256[49] -> uint256[49])␊
            - Slot changed from 1 to 2␊
            > Set __gap array to size 48␊
    ␊
    FAILED␊
    ␊
    Stderr: `

## validate - single contract, reference overrides upgrades-from

> Snapshot 1

    `Stdout:  ✘  contracts/test/cli/Validate.sol:UnsafeAndStorageLayoutErrors (upgrades from contracts/test/cli/Validate.sol:Safe)␊
    ␊
          contracts/test/cli/Validate.sol:97: Use of selfdestruct is not allowed␊
              https://zpl.in/upgrades/error-003␊
    ␊
    FAILED␊
    ␊
    Stderr: `

## validate - single contract, reference is uups, overrides upgrades-from

> Snapshot 1

    `Stdout:  ✘  contracts/test/cli/Validate.sol:BecomesBadLayout (upgrades from contracts/test/cli/Validate.sol:HasUpgradeTo)␊
    ␊
          contracts/test/cli/Validate.sol:111: Implementation is missing a public \`upgradeTo(address)\` or \`upgradeToAndCall(address,bytes)\` function␊
              Inherit UUPSUpgradeable to include one or both of these functions in your contract␊
              @openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol␊
              https://zpl.in/upgrades/error-008␊
    ␊
    FAILED␊
    ␊
    Stderr: `

## validate - single contract, reference

> Snapshot 1

    `Stdout:  ✘  contracts/test/cli/Validate.sol:BecomesBadLayout (upgrades from contracts/test/cli/Validate.sol:StorageV1)␊
    ␊
          StorageV1: Deleted \`x\`␊
            > Keep the variable even if unused␊
          ␊
          StorageV1: Deleted \`__gap\`␊
            > Keep the variable even if unused␊
    ␊
    FAILED␊
    ␊
    Stderr: `

## validate - single contract, reference, fully qualified names

> Snapshot 1

    `Stdout:  ✘  contracts/test/cli/Validate.sol:BecomesBadLayout (upgrades from contracts/test/cli/Validate.sol:StorageV1)␊
    ␊
          StorageV1: Deleted \`x\`␊
            > Keep the variable even if unused␊
          ␊
          StorageV1: Deleted \`__gap\`␊
            > Keep the variable even if unused␊
    ␊
    FAILED␊
    ␊
    Stderr: `

## validate - requireReference - no reference, has upgradesFrom - safe

> Snapshot 1

    ` ✔  contracts/test/cli/Validate.sol:BecomesSafe (upgrades from contracts/test/cli/Validate.sol:MultipleUnsafe)␊
    ␊
    SUCCESS␊
    `

## validate - requireReference - no reference, has upgradesFrom - unsafe

> Snapshot 1

    `Stdout:  ✘  contracts/test/cli/Validate.sol:BecomesBadLayout (upgrades from contracts/test/cli/Validate.sol:BecomesSafe)␊
    ␊
          BecomesSafe: Deleted \`x\`␊
            > Keep the variable even if unused␊
    ␊
    FAILED␊
    ␊
    Stderr: `

## validate - requireReference - has reference - unsafe

> Snapshot 1

    `Stdout:  ✘  contracts/test/cli/Validate.sol:StorageV2_Bad_NoAnnotation (upgrades from contracts/test/cli/Validate.sol:StorageV1)␊
    ␊
          contracts/test/cli/Validate.sol:147: Layout changed for \`__gap\` (uint256[49] -> uint256[49])␊
            - Slot changed from 1 to 2␊
            > Set __gap array to size 48␊
    ␊
    FAILED␊
    ␊
    Stderr: `

## validate - requireReference - has reference - safe

> Snapshot 1

    ` ✔  contracts/test/cli/Validate.sol:StorageV2_Ok_NoAnnotation (upgrades from contracts/test/cli/Validate.sol:StorageV1)␊
    ␊
    SUCCESS␊
    `

## validate - no upgradeable

> Snapshot 1

    `No upgradeable contracts detected.␊
    `

## validate - ok

> Snapshot 1

    ` ✔  contracts/test/cli/Annotation.sol:Annotation␊
    ␊
    SUCCESS (1 upgradeable contract detected, 1 passed, 0 failed)␊
    `

## validate - single contract - ok

> Snapshot 1

    ` ✔  contracts/test/cli/Annotation.sol:Annotation␊
    ␊
    SUCCESS␊
    `
